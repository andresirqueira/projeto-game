<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    
    <!-- PWA Meta Tags -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Asas em Combate">
    <meta name="theme-color" content="#1a1a2e">
    
    <!-- Manifest -->
    <link rel="manifest" href="manifest.json">
    
    <title>🦅 Asas em Combate</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Overlay de Rotação (Mobile Portrait) -->
    <div class="rotate-overlay" id="rotateOverlay">
        <div class="rotate-content">
            <div class="rotate-icon">📱</div>
            <h2>Gire seu dispositivo</h2>
            <p>Para uma melhor experiência, por favor, gire seu dispositivo para o modo paisagem (landscape).</p>
            <div class="rotate-arrow">↻</div>
        </div>
    </div>
    
    <!-- Indicador de Debug Mode -->
    <div class="debug-indicator" id="debugIndicator">🔧 DEBUG MODE</div>
    
    <!-- Menu Inicial -->
    <div class="menu-overlay" id="menuOverlay">
        <!-- Versão do Jogo -->
        <div class="game-version" id="gameVersion">v0.0.2</div>
        
        <!-- Botões de Áudio -->
        <div class="audio-controls">
            <button class="audio-btn" id="musicBtn" onclick="toggleMusic()" title="Música">🎵</button>
            <button class="audio-btn" id="sfxBtn" onclick="toggleSFX()" title="Efeitos Sonoros">🔊</button>
        </div>
        
        <div class="menu-title">🦅 Asas em Combate 🦅</div>
        
        <!-- Sistema de Vidas e Moedas -->
        <div class="lives-coins-container">
            <div class="lives-display">
                <span class="lives-label">❤️ Vidas:</span>
                <span class="lives-count" id="livesCount">5</span>
                <span class="lives-timer" id="livesTimer"></span>
            </div>
            <div class="coins-display">
                <span class="coins-label">🪙 Moedas:</span>
                <span class="coins-count" id="coinsCount">0</span>
            </div>
            <button class="buy-life-btn" id="buyLifeBtn" onclick="buyLifeWithCoins()" style="display: none;">💚 Comprar Vida (50🪙)</button>
        </div>
        
        <canvas id="menuCanvas" width="180" height="135"></canvas>

        <div class="menu-buttons">
            <button class="menu-btn start-btn" onclick="startGame()">🎮 JOGAR</button>
            <button class="menu-btn options-btn" onclick="toggleOptions()">⚙️ OPÇÕES</button>
            <button class="menu-btn rules-btn" onclick="toggleRules()">📋 REGRAS</button>
            <button class="menu-btn credits-btn" onclick="showCredits()">🙏 CRÉDITOS</button>
        </div>
        
        <div class="roadmap-overlay" id="roadmapOverlay">
            <div class="roadmap-box">
                <h3>🗺️ Selecione a Área</h3>
                
                <div class="roadmap-areas" id="roadmapAreas">
                    <div class="area-card unlocked" id="area1" onclick="openArea(1)">
                        <div class="area-icon">🌳</div>
                        <div class="area-name">Floresta</div>
                        <div class="area-progress" id="areaProgress1">0/7</div>
                    </div>
                    
                    <div class="area-card locked" id="area2">
                        <div class="area-lock">🔒</div>
                        <div class="area-name">Pântano</div>
                        <div class="area-progress" id="areaProgress2">0/7</div>
                    </div>
                    
                    <div class="area-card locked" id="area3">
                        <div class="area-lock">🔒</div>
                        <div class="area-name">Ilha Tropical</div>
                        <div class="area-progress" id="areaProgress3">0/7</div>
                    </div>
                    
                    <div class="area-card locked" id="area4">
                        <div class="area-lock">🔒</div>
                        <div class="area-name">Deserto</div>
                        <div class="area-progress" id="areaProgress4">0/7</div>
                    </div>
                    
                    <div class="area-card locked" id="area5">
                        <div class="area-lock">🔒</div>
                        <div class="area-name">Metrópole</div>
                        <div class="area-progress" id="areaProgress5">0/7</div>
                    </div>
                </div>
                
                <button class="back-roadmap-btn" onclick="closeRoadmap()">⬅ VOLTAR</button>
            </div>
        </div>
        
        <!-- Sub-fases de uma área -->
        <div class="substages-overlay" id="substagesOverlay">
            <div class="substages-box">
                <h3 id="substagesTitle">🌳 Floresta</h3>
                
                <div class="substages-grid" id="substagesGrid">
                    <!-- Gerado por JavaScript -->
                </div>
                
                <button class="back-roadmap-btn" onclick="closeSubstages()">⬅ VOLTAR</button>
            </div>
        </div>

        <div class="options-overlay" id="optionsOverlay">
            <div class="options-box">
                <h3>⚙️ Opções</h3>
                
                <div class="color-selection">
                    <h4>🎨 Escolha sua cor:</h4>
                    <p class="color-cost-info">💰 Custo: <span id="colorCostDisplay">25</span> moedas</p>
                    
                    <canvas id="colorPreviewCanvas" width="120" height="90"></canvas>
                    
                    <div class="color-options" id="colorOptions">
                        <div class="color-option selected" data-color="#2ecc71" data-wing="#27ae60" onclick="selectColor(this)" style="background: #2ecc71;"></div>
                        <div class="color-option" data-color="#3498db" data-wing="#2980b9" onclick="selectColor(this)" style="background: #3498db;"></div>
                        <div class="color-option" data-color="#9b59b6" data-wing="#8e44ad" onclick="selectColor(this)" style="background: #9b59b6;"></div>
                        <div class="color-option" data-color="#f1c40f" data-wing="#d4ac0d" onclick="selectColor(this)" style="background: #f1c40f;"></div>
                        <div class="color-option" data-color="#e91e63" data-wing="#c2185b" onclick="selectColor(this)" style="background: #e91e63;"></div>
                        <div class="color-option" data-color="#00bcd4" data-wing="#0097a7" onclick="selectColor(this)" style="background: #00bcd4;"></div>
                        <div class="color-option" data-color="#ff5722" data-wing="#e64a19" onclick="selectColor(this)" style="background: #ff5722;"></div>
                        <div class="color-option" data-color="#795548" data-wing="#5d4037" onclick="selectColor(this)" style="background: #795548;"></div>
                    </div>
                </div>
                
                <div class="difficulty-selection">
                    <h4>🎯 Dificuldade:</h4>
                    <div class="difficulty-options">
                        <button class="difficulty-btn" data-difficulty="easy" onclick="selectDifficulty('easy')">😊 Fácil</button>
                        <button class="difficulty-btn selected" data-difficulty="normal" onclick="selectDifficulty('normal')">😐 Normal</button>
                        <button class="difficulty-btn" data-difficulty="hard" onclick="selectDifficulty('hard')">😈 Difícil</button>
                    </div>
                    <p class="difficulty-desc" id="difficultyDesc">CPU com velocidade e inteligência normais.</p>
                </div>
                
                <div class="control-selection" id="controlSelection">
                    <h4>📱 Controle Mobile:</h4>
                    <div class="control-options">
                        <button class="control-btn" data-control="drag" id="controlDrag" onclick="selectControlMode('drag')">👆 Arrastar Pássaro</button>
                        <button class="control-btn" data-control="joystick" id="controlJoystick" onclick="selectControlMode('joystick')">🎮 Joystick</button>
                    </div>
                    <p class="control-desc" id="controlDesc">Toque e arraste o pássaro diretamente pela tela.</p>
                </div>
                
                <div class="fullscreen-selection">
                    <h4>🖥️ Tela Cheia:</h4>
                    <button class="fullscreen-option-btn" id="fullscreenOptionBtn" onclick="toggleFullscreen()">⛶ Ativar Tela Cheia</button>
                    <p class="fullscreen-desc">Use toda a tela para uma experiência imersiva.</p>
                </div>
                
                <div class="debug-selection" id="debugSelection">
                    <h4>🔧 Modo Debug:</h4>
                    <button class="debug-option-btn" id="debugOptionBtn" onclick="toggleDebugMode()">🔧 Ativar Debug</button>
                    <p class="debug-desc">Ative para testar vitórias, derrotas e outras funcionalidades.</p>
                </div>
                
                <div class="reset-section">
                    <h4>🗑️ Reiniciar:</h4>
                    <button class="reset-btn" onclick="confirmResetProgress()">🔄 Zerar Evolução</button>
                </div>
                
                <button class="close-options-btn" onclick="toggleOptions()">✔ CONFIRMAR</button>
            </div>
        </div>
        
        <div class="rules-overlay" id="rulesOverlay">
            <div class="rules-box">
                <h3>📋 Como Jogar</h3>
                <ul>
                    <li>⌨️ Use <strong>SETAS</strong> ou <strong>WASD</strong> para mover</li>
                    <li>🍎 Coma mais frutas que a CPU em <strong>60 segundos</strong></li>
                    <li>⬇️ Frutas caem do céu - só pode comer <strong>no chão!</strong></li>
                    <li>💥 <strong>Colida</strong> com o adversário para atordoá-lo!</li>
                    <li>🔋 Coma <strong>20 frutas</strong> para carregar o stun!</li>
                    <li>🌟 Comidas <strong>douradas no céu</strong> valem 5 pts e +5 stun!</li>
                    <li>⚡ Pegue o <strong>item azul</strong> para ganhar velocidade!</li>
                    <li>⚠️ <strong>Cuidado!</strong> A CPU também pode te stunnar!</li>
                    <li>⭐ Ganhe <strong>5 estrelas</strong> baseadas na sua pontuação!</li>
                    <li>🪙 Ganhe <strong>moedas</strong> ao vencer fases (mais na primeira vitória)!</li>
                    <li>❤️ Você tem <strong>5 vidas</strong> - perde uma ao ser derrotado!</li>
                    <li>⏰ Vidas regeneram automaticamente a cada <strong>5 minutos</strong></li>
                    <li>🦇 <strong>Morcego</strong> aparece na floresta (fase 6) - cuidado!</li>
                    <li>🦅 <strong>Gavião</strong> aparece no deserto (fase 6) - cuidado!</li>
                    <li>🌟 <strong>Fases Bônus:</strong> Colete minhocas, frutas congeladas ou frutos de cactos!</li>
                    <li>🎨 Mude sua cor por <strong>25 moedas</strong> nas opções!</li>
                </ul>
                <button class="close-rules-btn" onclick="toggleRules()">✖ FECHAR</button>
            </div>
        </div>
        
        <div class="credits-overlay" id="creditsOverlay">
            <div class="credits-box">
                <h3>🙏 Créditos dos Áudios</h3>
                <div class="credits-content" id="creditsContent">
                    <p>Carregando créditos...</p>
                </div>
                <button class="close-credits-btn" onclick="toggleCredits()">✖ FECHAR</button>
            </div>
        </div>
    </div>

    <!-- Contagem Regressiva -->
    <div class="countdown-overlay" id="countdownOverlay">
        <div class="countdown-header">
            <div class="countdown-stage-info" id="countdownStageInfo"></div>
            <div class="countdown-vs" id="countdownVs">⚔️ PREPARE-SE PARA A BATALHA ⚔️</div>
        </div>
        <div class="countdown-scene">
            <canvas id="countdownCanvas" width="600" height="200"></canvas>
        </div>
        <div class="countdown-number" id="countdownNumber">3</div>
        <div class="countdown-effects" id="countdownEffects"></div>
        <div class="countdown-particles" id="countdownParticles"></div>
    </div>

    <!-- Container do Jogo -->
    <div class="game-container" id="gameContainer">
        <!-- Botões de Áudio e Tela Cheia -->
        <div class="audio-controls">
            <button class="audio-btn" id="musicBtnGame" onclick="toggleMusic()" title="Música">🎵</button>
            <button class="audio-btn" id="sfxBtnGame" onclick="toggleSFX()" title="Efeitos Sonoros">🔊</button>
            <button class="audio-btn fullscreen-btn" id="fullscreenBtn" onclick="toggleFullscreen()" title="Tela Cheia">⛶</button>
        </div>
        
        <!-- Elementos HTML escondidos (agora desenhados no canvas) -->
        <!-- UI especial para fase bônus -->
        <div class="bonus-ui" id="bonusUI" style="display: none;">
            <div class="bonus-counter">🪱 Minhocas: <span id="wormCount">0</span> / <span id="wormGoal">25</span></div>
        </div>
        
        <div class="timer" id="timerContainer" style="display: none;">⏱️ Tempo: <span id="timer">60</span>s</div>
        
        <div class="cooldown-container" id="cooldownContainer" style="display: none;">
            💥 Stun: <div class="cooldown-bar"><div class="cooldown-fill" id="cooldownFill"></div></div> <span id="cooldownText">0/20</span>
        </div>
        
        <canvas id="game" width="800" height="500"></canvas>
        
        <p class="instructions" id="gameInstructions" style="display: none;"></p>

        <!-- Controles Touch (apenas para mobile) -->
        <div class="touch-controls" id="touchControls">
            <!-- Joystick Virtual -->
            <div class="joystick-container">
                <div class="joystick-base" id="joystickBase">
                    <div class="joystick-stick" id="joystickStick"></div>
                </div>
            </div>
        </div>

        <!-- Painel de Debug -->
        <div class="debug-panel" id="debugPanel">
            <div style="color: #f1c40f; font-size: 0.7rem; margin-bottom: 5px; text-align: center;">🔧 DEBUG MODE</div>
            <button class="debug-btn boss" onclick="simulateBossVictory()">👑 Vitória Boss</button>
            <button class="debug-btn victory" onclick="simulateVictory()">🎉 Vitória Normal</button>
            <button class="debug-btn defeat" onclick="simulateDefeat()">😔 Derrota</button>
            <div style="color: #bdc3c7; font-size: 0.65rem; margin-top: 5px; text-align: center;">Ctrl+Shift+D</div>
        </div>

        <div class="game-over" id="gameOver">
            <canvas id="winnerCanvas" width="400" height="150"></canvas>
            <h2 id="resultTitle">Fim de Jogo!</h2>
            <p id="resultText"></p>
            <div class="result-buttons" id="resultButtons">
                <!-- Botões serão preenchidos pelo JavaScript -->
            </div>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>
